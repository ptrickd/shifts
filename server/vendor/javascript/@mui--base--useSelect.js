import e from"@babel/runtime/helpers/esm/extends";import*as t from"react";import{unstable_useForkRef as l,unstable_useId as n,unstable_useEnhancedEffect as o}from"@mui/utils";import{useButton as r}from"@mui/base/useButton";import{moveHighlight as u,handleItemSelection as s,listReducer as i,ListActionTypes as a,useList as c}from"@mui/base/useList";import{d as p}from"../_/CiCPIxyG.js";export{S as SelectProvider}from"../_/CiCPIxyG.js";import{useCompoundParent as d}from"#useCompound";import{e as f}from"../_/q-ZiAH4M.js";import{c as m}from"../_/1TTNQAt_.js";import"../_/oIkCyQjV.js";import"react/jsx-runtime";const g={buttonClick:"buttonClick",browserAutoFill:"browserAutoFill"};function selectReducer(t,l){const{open:n}=t;const{context:{selectionMode:o}}=l;if(l.type===g.buttonClick){var r;const o=(r=t.selectedValues[0])!=null?r:u(null,"start",l.context);return e({},t,{open:!n,highlightedValue:n?null:o})}if(l.type===g.browserAutoFill)return s(l.item,t,l.context);const c=i(t,l);switch(l.type){case a.keyDown:if(t.open){if(l.event.key==="Escape")return e({},c,{open:false});if(o==="single"&&(l.event.key==="Enter"||l.event.key===" "))return e({},c,{open:false})}else{if(l.event.key==="Enter"||l.event.key===" "||l.event.key==="ArrowDown"){var p;return e({},t,{open:true,highlightedValue:(p=t.selectedValues[0])!=null?p:u(null,"start",l.context)})}if(l.event.key==="ArrowUp"){var d;return e({},t,{open:true,highlightedValue:(d=t.selectedValues[0])!=null?d:u(null,"end",l.context)})}}break;case a.itemClick:if(o==="single")return e({},c,{open:false});break;case a.blur:return e({},c,{open:false});default:return c}return c}"use client";const v={clip:"rect(1px, 1px, 1px, 1px)",clipPath:"inset(50%)",height:"1px",width:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",left:"50%",bottom:0};function defaultFormValueProvider(e){return Array.isArray(e)?e.length===0?"":JSON.stringify(e.map((e=>e.value))):(e==null?void 0:e.value)==null?"":typeof e.value==="string"||typeof e.value==="number"?e.value:JSON.stringify(e.value)}function preventDefault(e){e.preventDefault()}function useSelect(u){const{areOptionsEqual:s,buttonRef:i,defaultOpen:b=false,defaultValue:h,disabled:x=false,listboxId:k,listboxRef:C,multiple:y=false,name:V,required:R,onChange:w,onHighlightChange:M,onOpenChange:A,open:P,options:S,getOptionAsString:D=p,getSerializedValue:O=defaultFormValueProvider,value:I}=u;const F=t.useRef(null);const j=l(i,F);const _=t.useRef(null);const B=n(k);let E;I===void 0&&h===void 0?E=[]:h!==void 0&&(E=y?h:h==null?[]:[h]);const q=t.useMemo((()=>{if(I!==void 0)return y?I:I==null?[]:[I]}),[I,y]);const{subitems:H,contextValue:J}=d();const L=t.useMemo((()=>S!=null?new Map(S.map(((e,l)=>[e.value,{value:e.value,label:e.label,disabled:e.disabled,ref:t.createRef(),id:`${B}_${l}`}]))):H),[S,H,B]);const N=l(C,_);const{getRootProps:T,active:$,focusVisible:z,rootRef:U}=r({disabled:x,rootRef:j});const G=t.useMemo((()=>Array.from(L.keys())),[L]);const K=t.useCallback((e=>{if(s!==void 0){const t=G.find((t=>s(t,e)));return L.get(t)}return L.get(e)}),[L,s,G]);const Q=t.useCallback((e=>{var t;const l=K(e);return(t=l==null?void 0:l.disabled)!=null&&t}),[K]);const W=t.useCallback((e=>{const t=K(e);return t?D(t):""}),[K,D]);const X=t.useMemo((()=>({selectedValues:q,open:P})),[q,P]);const Y=t.useCallback((e=>{var t;return(t=L.get(e))==null?void 0:t.id}),[L]);const Z=t.useCallback(((e,t)=>{if(y)w==null||w(e,t);else{var l;w==null||w(e,(l=t[0])!=null?l:null)}}),[y,w]);const ee=t.useCallback(((e,t)=>{M==null||M(e,t!=null?t:null)}),[M]);const te=t.useCallback(((e,t,l)=>{if(t==="open"){A==null||A(l);if(l===false&&(e==null?void 0:e.type)!=="blur"){var n;(n=F.current)==null||n.focus()}}}),[A]);const le={getInitialState:()=>{var e;return{highlightedValue:null,selectedValues:(e=E)!=null?e:[],open:b}},getItemId:Y,controlledProps:X,itemComparer:s,isItemDisabled:Q,rootRef:U,onChange:Z,onHighlightChange:ee,onStateChange:te,reducerActionContext:t.useMemo((()=>({multiple:y})),[y]),items:G,getItemAsString:W,selectionMode:y?"multiple":"single",stateReducer:selectReducer};const{dispatch:ne,getRootProps:oe,contextValue:re,state:{open:ue,highlightedValue:se,selectedValues:ie},rootRef:ae}=c(le);const createHandleButtonMouseDown=e=>t=>{var l;e==null||(l=e.onMouseDown)==null||l.call(e,t);if(!t.defaultMuiPrevented){const e={type:g.buttonClick,event:t};ne(e)}};o((()=>{if(se!=null){var e;const t=(e=K(se))==null?void 0:e.ref;if(!_.current||!(t!=null&&t.current))return;const l=_.current.getBoundingClientRect();const n=t.current.getBoundingClientRect();n.top<l.top?_.current.scrollTop-=l.top-n.top:n.bottom>l.bottom&&(_.current.scrollTop+=n.bottom-l.bottom)}}),[se,K]);const ce=t.useCallback((e=>K(e)),[K]);const getSelectTriggerProps=(t={})=>e({},t,{onMouseDown:createHandleButtonMouseDown(t),ref:ae,role:"combobox","aria-expanded":ue,"aria-controls":B});const getButtonProps=(t={})=>{const l=f(t);const n=m(T,oe);const o=m(n,getSelectTriggerProps);return e({},t,o(l))};const getListboxProps=(t={})=>e({},t,{id:B,role:"listbox","aria-multiselectable":y?"true":void 0,ref:N,onMouseDown:preventDefault});t.useDebugValue({selectedOptions:ie,highlightedOption:se,open:ue});const pe=t.useMemo((()=>e({},re,J)),[re,J]);let de;de=u.multiple?ie:ie.length>0?ie[0]:null;let fe;if(y)fe=de.map((e=>ce(e))).filter((e=>e!==void 0));else{var me;fe=(me=ce(de))!=null?me:null}const createHandleHiddenInputChange=e=>t=>{var l;e==null||(l=e.onChange)==null||l.call(e,t);if(t.defaultMuiPrevented)return;const n=L.get(t.target.value);t.target.value===""?ne({type:a.clearSelection}):n!==void 0&&ne({type:g.browserAutoFill,item:n.value,event:t})};const getHiddenInputProps=(t={})=>{const l=f(t);return e({name:V,tabIndex:-1,"aria-hidden":true,required:!!R||void 0,value:O(fe),style:v},t,{onChange:createHandleHiddenInputChange(l)})};return{buttonActive:$,buttonFocusVisible:z,buttonRef:U,contextValue:pe,disabled:x,dispatch:ne,getButtonProps:getButtonProps,getHiddenInputProps:getHiddenInputProps,getListboxProps:getListboxProps,getOptionMetadata:ce,listboxRef:ae,open:ue,options:G,value:de,highlightedOption:se}}"use client";export{g as SelectActionTypes,useSelect};

